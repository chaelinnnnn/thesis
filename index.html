<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Appropriation Infection</title>

<style>
html,body{
  margin:0;
  background:#f5f5f5;
  font-family:monospace;
  overflow:hidden;
}

#stage{
  position:relative;
  width:100vw;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

#sentence{
  font-size:40px;
  line-height:1.4;
  text-align:center;
  width:900px;
  position:relative;
}

.word{
  position:relative;
  display:inline-block;
}

canvas{
  position:absolute;
  pointer-events:none;
}

#lens{
  position:absolute;
  width:280px;
  height:280px;
  border-radius:50%;
  border:2px solid rgba(0,0,0,.2);
  backdrop-filter:blur(3px);
  pointer-events:none;
  mix-blend-mode:normal;
}
</style>
</head>
<body>

<div id="stage">
  <div id="sentence"></div>
  <div id="lens"></div>
</div>

<script>
const TEXT = "Then they discovered the beauty of merchandise and started making it relentlessly.";

const MAP = {
  beauty: "VALUATION",
  merchandise: "COMMODITY",
  making: "OPTIMIZING"
};

const stage = document.getElementById("stage");
const sentenceEl = document.getElementById("sentence");
const lens = document.getElementById("lens");

let lensX = window.innerWidth/2;
let lensY = window.innerHeight/2;
let activeWord = null;

// --- Split sentence into words ---
function renderSentence(){
  const words = TEXT.split(" ");
  words.forEach(w=>{
    const clean = w.replace(/[.,]/g,"").toLowerCase();
    const span = document.createElement("span");
    span.className="word";
    span.textContent = w + " ";
    span.dataset.word = clean;
    sentenceEl.appendChild(span);
  });
}
renderSentence();

// --- Create viral canvas over word ---
function infect(wordEl, replacement){

  if(wordEl.querySelector("canvas")) return;

  const rect = wordEl.getBoundingClientRect();
  const canvas = document.createElement("canvas");
  canvas.width = rect.width*1.6;
  canvas.height = rect.height*1.8;
  canvas.style.left = "-20%";
  canvas.style.top = "-40%";

  wordEl.style.color="transparent";
  wordEl.appendChild(canvas);

  const ctx = canvas.getContext("2d");

  const particles = [];
  const letters = replacement.split("");

  letters.forEach((letter,i)=>{
    const baseX = 20 + i* (canvas.width/(letters.length+1));
    const baseY = canvas.height/2;

    for(let j=0;j<35;j++){
      particles.push({
        x: baseX + (Math.random()-0.5)*40,
        y: baseY + (Math.random()-0.5)*40,
        size: Math.random()*4+2,
        vx: (Math.random()-0.5)*1.5,
        vy: (Math.random()-0.5)*1.5,
        targetX: baseX,
        targetY: baseY
      });
    }
  });

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    particles.forEach(p=>{
      p.x += (p.targetX - p.x)*0.02 + p.vx;
      p.y += (p.targetY - p.y)*0.02 + p.vy;

      ctx.beginPath();
      ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
      ctx.fillStyle="#222";
      ctx.fill();
    });

    requestAnimationFrame(draw);
  }

  draw();
}

// --- Lens movement ---
document.addEventListener("mousemove",(e)=>{
  lensX=e.clientX;
  lensY=e.clientY;
  lens.style.left = lensX-140+"px";
  lens.style.top = lensY-140+"px";

  checkInfection();
});

function checkInfection(){
  const words = document.querySelectorAll(".word");
  words.forEach(w=>{
    const rect = w.getBoundingClientRect();
    const centerX = rect.left + rect.width/2;
    const centerY = rect.top + rect.height/2;

    const dist = Math.hypot(centerX - lensX, centerY - lensY);

    if(dist < 140){
      const key = w.dataset.word;
      if(MAP[key]){
        infect(w, MAP[key]);
      }
    }
  });
}

</script>
</body>
</html>

